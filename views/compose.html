<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Secret Scriptures</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>

    <div class="color-cover">
        <div class="cover-header">
            <a href="/home"><img class="logo" src="/content/Logo.svg" alt="My Secret Scriptures Logo"></a>
            <img id="cover-img" class="cover-img" src="" alt="A cover image">
        </div>

        <div class="container composer-outer mt-5">
            <div class="row">

                <div class="col-lg-10 col-sm-12">
                    <form id="composerForm" action="/scriptures" method="POST" class="d-flex flex-column gap-3">
                        <input type="date" name="date">
                        <input name="title" placeholder="What's on your mind today...">
                        <textarea oninput="heightAutoAdjust()" name="content"
                            placeholder="Whatever it is let go of it. Feeling stuck? Feel free to use a prompt..."></textarea>
                    </form>
                </div>

                <div class="tools col-lg-2 col-sm-12 d-flex flex-column gap-3">

                    <div data-audio="audio-ocean" class="record d-flex align-items-censter justify-content-end">
                        <div
                            class="play-btn-container d-flex align-items-center text-align-center justify-content-center gap-3">
                            Ocean
                            <img src="/content/ocean.png" alt="Icon">
                        </div>
                        <audio id="audio-ocean" src="/sounds/Ocean.mp3"></audio>
                    </div>
                    <div data-audio="audio-forest" class="record d-flex align-items-censter justify-content-end">
                        <div
                            class="play-btn-container d-flex align-items-center text-align-center justify-content-center gap-3">
                            Forest
                            <img src="/content/tree.png" alt="Icon">
                        </div>
                        <audio id="audio-forest" src="/sounds/Forest.mp3"></audio>
                    </div>
                    <div data-audio="audio-mantra" class="record d-flex align-items-censter justify-content-end">
                        <div
                            class="play-btn-container d-flex align-items-center text-align-center justify-content-center gap-3">
                            Mantra
                            <img src="/content/dream.png" alt="Icon">
                        </div>
                        <audio id="audio-mantra" src="/sounds/Mantra.mp3"></audio>
                    </div>
                    <div data-audio="audio-tibetan" class="record d-flex align-items-censter justify-content-end">
                        <div
                            class="play-btn-container d-flex align-items-center text-align-center justify-content-center gap-3">
                            Tibetan
                            <img src="/content/bowl.png" alt="Icon">
                        </div>
                        <audio id="audio-tibetan" src="/sounds/Tibetan.mp3"></audio>
                    </div>

                    <button class="generate-prompt">Pick a Prompt</button>
                    <button form="composerForm" class="align-self-start save-exit" type="Submit">Save & Exit</button>

                </div>
            </div>
        </div>
    </div>

    <script src="https://kit.fontawesome.com/c193febbe5.js" crossorigin="anonymous"></script>

    <script>
        const recordButtons = document.querySelectorAll(".record");
        let currentAudio;

        recordButtons.forEach((button) => {
            const audioId = button.dataset.audio;
            const audioElement = document.getElementById(audioId);

            button.addEventListener("click", () => {
                if (currentAudio && currentAudio !== audioElement) {
                    currentAudio.pause();
                }

                if (audioElement.paused) {
                    audioElement.play();
                } else {
                    audioElement.pause();
                }

                currentAudio = audioElement;
            });
        });

        document.querySelector(".generate-prompt").addEventListener("click", async () => {
            const categoryName = document.querySelector('#composerForm').dataset.category;
            const response = await fetch(`/api/getRandomPrompt/${categoryName}`);
            const { prompt } = await response.json();
            const titleInput = document.querySelector("input[name='title']");
            titleInput.value = prompt;
        });

        // Get the current route from the URL
        const currentRoute = window.location.pathname.split('/').pop();
        // Update the data-category attribute of the form element
        const composerForm = document.getElementById('composerForm');
        composerForm.setAttribute('data-category', currentRoute);

        const categoryName = window.location.pathname.split('/').pop();

        const coverImageMap = {
            contemplate: '/content/Cover-contemplate.png',
            reflect: '/content/Cover-reflect.png',
            explore: '/content/Cover-explore.png',
            wonder: '/content/Cover-wonder.png',
        };

        const coverImgElement = document.getElementById('cover-img');
        if (coverImageMap.hasOwnProperty(categoryName)) {
            coverImgElement.src = coverImageMap[categoryName];
        } else {
            console.log("No such category")
        }

        function heightAutoAdjust() {
        const textarea = document.querySelector("textarea");
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    </script>


</body>

</html>